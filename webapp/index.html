<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8" />
    <meta name="format-detection" content="telephone=no" />
    <meta name="msapplication-tap-highlight" content="no" />
    <meta name="viewport" content="viewport-fit=cover, width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#0b98de">

    <meta http-equiv="Content-Security-Policy" content="connect-src 'self' https://*.auth0.com https://*.couponbooked.com https://onesignal.com/api/v1/ https://checkout.stripe.com; 
        default-src 'self' data: gap: 'unsafe-inline' https://ssl.gstatic.com https://couponbooked.auth0.com https://cdn.onesignal.com https://onesignal.com https://cdn.auth0.com 
        https://unpkg.com/uuid@latest/dist/umd/ https://code.jquery.com/ui/1.12.1/ https://js.stripe.com/ https://checkout.stripe.com/ https://cdnjs.cloudflare.com/ajax/libs/jshashes/
        https://cdnjs.cloudflare.com/ajax/libs/cloudinary-core/2.8.2/ https://widget.cloudinary.com/v2.0/global/ https://widget.cloudinary.com/v2.0/n/couponbooked/; 
        style-src 'self' 'unsafe-inline' https://cdn.auth0.com https://checkout.stripe.com/v3/checkout/; media-src *; img-src *; font-src *;" />
    
    <link rel="stylesheet" type="text/css" href="css/index.css" />
    <link rel="stylesheet" type="text/css" href="css/nav.css" />
    <link rel="stylesheet" type="text/css" href="css/auth0-theme.min.css" />
    <link rel="stylesheet" type="text/css" href="css/main.css" />
    <link rel="stylesheet" type="text/css" href="css/index.css" />
    <link rel="stylesheet" type="text/css" href="css/fontawesome.css" />
    <link rel="stylesheet" type="text/css" href="css/materialize.css" />
    <link rel="stylesheet" type="text/css" href="css/simpleNotification.css" />
    <link rel="stylesheet" type="text/css" href="css/gooMenu.css" />
    <link rel="stylesheet" type="text/css" href="css/jquery-ui.css">
    <link rel="stylesheet" type="text/css" href="css/desktop.css">

    <!-- Hangle all the icons on different platforms, courtesy of https://favicon.io/favicon-converter/ -->
    <link rel="apple-touch-icon" sizes="180x180" href="../images/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="../images/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="../images/favicon-16x16.png">
    <link rel="manifest" href="../images/site.webmanifest">

    <!-- TODO: Find a way to prevent my adblocker from blocking this, and to allow
        it through the security policy. Test new method with blocker!! -->
    <script src="https://cdn.onesignal.com/sdks/OneSignalSDK.js" async=""></script>
    <script src="https://cdn.auth0.com/js/auth0/9.13.0/auth0.min.js"></script>
    <script src="https://cdn.auth0.com/w2/auth0-7.2.min.js"></script>
    <script src="https://unpkg.com/uuid@latest/dist/umd/uuidv4.min.js"></script>
    <script src="https://js.stripe.com/v3"></script>

    <script>
        // Copied from OneSignal website
        var OneSignal = window.OneSignal || [];
        OneSignal.push(function() {
            OneSignal.init({
                appId: "40029422-22e0-4569-9d55-8b6604ce2503",
            });
        });
    </script>

    <title>Coupon Booked</title>
</head>

<body>
    <!-- HTML is my templating engine and CSS is my router -->
    <div class="app" id="app"></div>

    <template id="loading">
        <!-- NOTE: This is just here to be saved for other routes -->
        <div id="nav">
            <div class="nav-container">
                <nav class="navbar navbar-expand-md navbar-light">
                    <div class="container">
                        <div id="mobile">
                            <span class="menu-btn">
                                <img id="logo" src="../images/logo_small.png">
                            </span>
                            <a id="brand" href="https://couponbooked.com/webapp">Coupon Booked</a>
                        </div>
        
                        <div class="collapse navbar-collapse">
                            <ul class="navbar-nav">
                                <!-- Fullsize dropdown: show if authenticated -->
                                <li class="nav-item dropdown">
                                    <a class="nav-link dropdown-toggle account" data-toggle="dropdown">
                                        <!-- Profile image should be set to the profile picture from the id token;
                                            src is the default image until the user's profile pic loads in -->
                                        <img alt="Profile picture" src="./images/default.png" class="nav-user-profile profile-image" />
                                    </a>
                                </li>
                            </ul>
                        </div> <!-- navbar-collapse -->
                    </div> <!-- container -->

                    <ul id="desktopNav" style="display: none;">
                        <li class="dashboard">Dashboard</li>
                        <li class="guide">Guide</li>
                        <li class="settings">Settings</li>
                    </ul>
                </nav> <!-- navbar -->
            </div> <!-- nav-container -->
        
            <!-- https://www.labw3.com/2014/08/round-avatar-with-drop-down-profiles-menu-code.html -->
            <div class="dropdown">
                <div class="submenu" style="display: none;">
                    <ul class="root">
                        <!-- IDEA: Can add relevant icons for each item -->
                        <li><a href="#" class="dashboard">Dashboard</a></li>
                        <li><a href="#" class="guide">Guide</a></li>
                        <li><a href="#" class="settings">Settings</a></li>
                    </ul>
                </div>
            </div> <!-- dropdown -->
        </div>

        <!-- Loading icon - https://tobiasahlin.com/spinkit/ -->
        <div id="loader">
            <div class="spinner">
                <div class="rect1"></div>
                <div class="rect2"></div>
                <div class="rect3"></div>
                <div class="rect4"></div>
                <div class="rect5"></div>
            </div>
        </div>

        <style> .spinner { display: none; } </style>
    </template>

    <template id="login">
        <!-- Loading screen for redirect to Auth0 login page -->
    </template>

    <template id="home">
        <div class="page">
            <!-- TODO -->
        </div>
    </template>

    <template id="guide">
        <link rel="stylesheet" type="text/css" href="css/app.css" />

        <div class="page">
            <h2>Guide</h2>
            <br />

            <!-- NOTE: Can also switch to https://jsfiddle.net/ajmeese7/bhsf2q3u/1/ sometime if I want to -->
            <h4>Creating a new book</h4>
            <p>
                To create a book, go to the dashboard and click the 'Sent' tab.
                From here you can click the blue plus button in the bottom right
                corner of the screen and it will redirect you to the book creation
                screen. Once you select the template you want you will be able to 
                modify the book however you want. To save it to edit in the future,
                click the "Create" button in the upper right hand corner.
            </p>

            <h4>Sharing a book</h4>
            <p>
                Once you have created a coupon book, you can share it by clicking the 
                "Share" button in the upper right hand corner. You are free to edit the
                book any time before sending it and after you have sent it, so don't stress
                if you need to go back and add more coupons later. We are currently only
                charging to share the book and have no plans to change that in the future.
            </p>

            <h4>Redeeming a book code</h4>
            <p>
                To redeem a book code, go to the dashboard and click the 'Received' tab.
                From here you can click the green "Redeem a code" button in the bottom
                right corner of the screen and it will redirect you to the code redemption
                screen.
            </p>

            <h4>Changing your display name</h4>
            <p>
                When you send someone a coupon code and they redeem it, the book will display
                who sent it. If you logged in through Google this will be your name, but if you
                created an account you will have to change it on the settings page. You can
                type whatever you want to be shown to people in the "Display Name" field and 
                click the update button to submit the new display name. If you update when the 
                field is empty, your default display name will show again.
            </p>

            <h4>App looks strange</h4>
            <p>
                If you have your accessibility settings set to anything other than the device's 
                default, the app may be displayed strangely. I am currently working on a fix for 
                this but unfortunately as of now there is no way to resolve it other than by changing 
                the settings on your device.
            </p>
        </div>
    </template>

    <template id="create">
        <!-- Invisible back arrow to support functions without much modification -->
        <img class="hide" id="backArrow" />
        <h2 id="createHeader">Who is it for?</h2>

        <div id="templateContainer"></div>
    </template>

    <template id="sentBook">
        <div id="topbar">
            <img id="backArrow" src="./images/back.svg" />
            <button id="createButton">Create</button>
            <button id="save" class="hide">Save</button>
            <button id="delete" class="hide">Delete</button>
            <button id="share" class="hide">Pay</button>
        </div>
        
        <div id="bookContent" class="col">
            <!-- Will create new coupon -->
            <button id="plus">+</button>
        </div>

        <div id="couponPreview" class="hide col">
            <h3 id="namePreview"></h3>
            <hr />
            <img id="imgPreview" onerror="imageError(this)" src="./images/ticket.png" />
            <p id="descPreview"></p> <!-- TODO: Make this look better for short descriptions -->

            <!-- If iOS, icon is changed in Node -->
            <button id="edit"><img src="./images/md-edit.svg" /></button>
        </div>

        <div id="deleteCouponConfirm" class="dialog-box" title="Delete coupon confirmation">
            <p id="confirmText">
                <span class="ui-icon ui-icon-alert"></span>
                Are you sure you want to delete this coupon?
            </p>
        </div>

        <form id="couponForm" class="hide col">
            <!-- https://picnicss.com/documentation#dropimage -->
            <!-- https://stackoverflow.com/questions/4112575/client-checking-file-size-using-html5 -->
            <div>
                <img id="couponImage" height="100px" onerror="imageError(this)" src="./images/ticket.png" />
            </div>

            <!-- NOTE: Nearly all of this is copied directly from bookForm, so changes should be reflected there -->
            <button type="button" class="cloudinary-button">Change image</button>
            
            <!-- TODO: Need to get this to run on browser back button for desktop and native mobile -->
            <div id="discardCouponConfirm" class="dialog-box" title="Discard all changes?">
                <p id="confirmText">
                    <span class="ui-icon ui-icon-alert"></span>
                    Are you sure you want to discard your changes?
                </p>
            </div>

            <!-- IDEA: Cycle through an array of these for examples; appropriate to template? 
                Could be paired arrays to have description matched with name, or objects & pull fields -->
            <label for="name">Coupon Name</label>
            <input type="text" id="name" name="name" placeholder="Backrub">

            <label for="description">Description</label>
            <textarea id="couponDescription" name="description" placeholder="A nice, long massage." 
                maxlength="180"></textarea>
            <div id="couponDescLength">0</div>
            
            <label for="count">Count</label>
            <input type="number" id="count" name="count" min="1" max="99" placeholder="3">
        </form>

        <form id="bookForm" class="hide col">
            <div>
                <img id="bookImage" height="100px" onerror="imageError(this)" src="./images/ticket.png" />
            </div>

            <button type="button" class="cloudinary-button">Change image</button>
            
            <div id="discardBookEditsConfirm" class="dialog-box" title="Discard all changes">
                <p id="confirmText">
                    <span class="ui-icon ui-icon-alert"></span>
                    Are you sure you want to discard your changes?
                </p>
            </div>

            <label for="name">Book Name</label>
            <input type="text" id="bookName" name="name" placeholder="#1 Dad">

            <label for="desc">Description</label>
            <textarea id="bookDescription" name="description" placeholder="Thank you for everything you do." 
                maxlength="180"></textarea>
            <div id="bookDescLength">0</div>
        </form>

        <div id="deleteBookConfirm" class="dialog-box" title="Delete book confirmation">
            <p id="confirmText">
                <span class="ui-icon ui-icon-alert"></span>
                Are you sure you want to delete this book?
            </p>
        </div>

        <script id="moreOptions" type="text/html">
            <nav class="menu">
                <!-- TODO: Try to speed up this animation, and probably replace the hamburger
                    icon with ellipses or something. -->
                <input type="checkbox" href="#" class="menu-open" name="menu-open" id="menu-open"/>
                <label class="menu-open-button" for="menu-open">
                    <span class="hamburger hamburger-1"></span>
                    <span class="hamburger hamburger-2"></span>
                    <span class="hamburger hamburger-3"></span>
                </label>
                
                <a href="#editBook" class="menu-item">
                    <img id='editBook' class='ionicon' src='./images/md-edit.svg' />
                </a>
                <a href="#deleteBook" class="menu-item">
                    <img id='deleteBook' class='ionicon' src='./images/md-trash.svg' />
                </a>
            </nav>
        </script>
    </template>

    <template id="receivedBook">
        <div id="topbar">
            <img id="backArrow" src="./images/back.svg" />
        </div>
        
        <div id="bookContent" class="col"></div>

        <div id="couponPreview" class="hide col">
            <h3 id="namePreview"></h3>
            <hr />
            <img id="imgPreview" onerror="imageError(this)" src="./images/ticket.png" />
            <p id="descPreview"></p>

            <div id="redeemCouponConfirm" class="dialog-box" title="Redemption confirmation">
                <p id="confirmText">
                    <span class="ui-icon ui-icon-alert"></span>
                    <!--"Do you want to redeem this coupon?" 
                        need to figure out if icon is needed and stuff + which text to use -->
                    Are you sure you want to redeem this coupon?
                </p>
            </div>

            <div id="redeemCoupon">Redeem coupon</div>
        </div>
    </template>

    <template id="shareCode">
        <link rel="stylesheet" type="text/css" href="css/shareCode.css" />
        <div id="topbar">
            <img id="backArrow" src="./images/back.svg" />
        </div>

        <h4 id="shareHeader">Your book is ready to be sent!</h4>
        <div class="copytooltip">
            <span class="copytooltiptext" style="opacity: 0;">Copied to clipboard</span>
        </div>
        <div id="shareCodeDiv">
            <!-- TODO: Switch to having icons in different folders for different OS -->
            <p id="shareCodeText">88888888</p>
            <img id="copyButton" src="./images/copy.svg" />
            <!-- https://ionicons.com/ -->
        </div>

        <p id="shareCodeDescription">
            Send this code to whomever you want to receive your Coupon Book.
            They must create an account if they don't already have one to 
            redeem the code.
        </p>

        <button id="bigShareButton"><img id="shareIcon" class="ionicon" />SHARE</button>
    </template>

    <template id="redeemCode">
        <div id="topbar">
            <img id="backArrow" src="./images/back.svg" />
        </div>

        <h3 id="redeemHeader">Enter your code below</h3>
        <div>
            <input id="redeemBox" maxlength='8' autocapitalize="none" />
        </div>

        <button id="redeemButton">Redeem</button>
    </template>

    <template id="dashboard">
        <!-- Invisible back arrow to support functions without much modification -->
        <img class="hide" id="backArrow" />
        <ul id="tab-menu" class="tabs">
            <li class="tab"><a id="sentButton" href="#sent" class="active">Sent</a></li>
            <li class="tab"><a id="receivedButton" href="#received">Received</a></li>
        </ul>

        <!-- TODO: Try to redo all the stuff I just fucking accidentially deleted -->
        <div id="gestureZone">
            <div id="sent" class="col">
                <div id="noneSent" class="hidden">
                    <!-- Formatted like this in case I decide to add something else to message; 
                        if not, will switch to paragraph -->
                    You haven't sent any Books yet. <br />
                    <a id="start">Send one now!</a>
                </div>
                <button id="plus">+</button>
            </div>
            <div id="received" class="col">
                <div id="noneReceived" class="hidden">
                    <!-- IDEA: Implement UI for this elsewhere -->
                    You haven't received any Books yet. <br />
                    Want to <a id="request">request one</a>?
                </div>

                <div id="redeemLink">Redeem a code!</div>
            </div>
        </div>
    </template>

    <template id="settings">
        <link rel="stylesheet" type="text/css" href="css/app.css" />
        
        <div class="page">
            <h2>Settings</h2>
            <br />

            <!-- I honestly have no idea what this is -->
            <style id="switchStyle"></style>

            <b>Display Name</b>
            <label id="displayName">
                <input type="text" id="displayNameInput" name="displayName" placeholder="Robert Downey Jr.">
            </label>
            <button id="updateDisplayName">Update</button>
            <br />
            
            <!-- Dark mode inspired by https://github.com/GoogleChromeLabs/dark-mode-toggle -->
            <b>Dark Mode</b>
            <br />
            <label class="switch" id="darkToggle">
                <br />
                <input type="checkbox" id="darkCheckbox">
                <span class="slider round"></span>
            </label>
            <br />
            <hr />

            <div class="flex hor-centered">
                <button class="btn btn-success btn-logout">
                    <span>Log Out</span>
                </button>
            </div>
        </div>
    </template>

    <script src="js/jquery.min.js"></script>
    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.min.js"
        integrity="sha256-VazP97ZCwtekAsvgPBSUwPFKdrwD3unUfSGVYrahUqU="
        crossorigin="anonymous">
    </script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jshashes/1.0.8/hashes.min.js"></script>
    <script src="src/globalVars.js"></script>
    <script src="src/helperFunctions.js"></script>
    <script src="src/sentBooks.js"></script>
    <script src="src/receivedBooks.js"></script>
    <script src="src/shareBook.js"></script>
    <script src="src/App.js"></script>
    <script src="src/index.js"></script>
    <script src="js/materialize.js"></script>
    <script src="js/simpleNotification.min.js"></script>
    <script>
        /** For use in App.js and index.html when images don't load in properly */
        function imageError(image) {
            // TODO: Do something more helpful than logging element, such as making it
            // easier to track down which one has the problem, or just permenantly reset
            // the image in the JSON
            console.warn("Error loading image! Setting to default URL...", image);
            image.src = "images/ticket.png";
        }
    </script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/cloudinary-core/2.8.2/cloudinary-core.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/cloudinary-core/2.8.2/cloudinary-core.js.map"></script>
    <script src="https://widget.cloudinary.com/v2.0/global/all.js" type="text/javascript"></script>
</body>

</html>